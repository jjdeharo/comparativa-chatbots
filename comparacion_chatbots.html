<!DOCTYPE html>
<html lang="es" data-lt-installed="true">
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Comparación de chatbots gratuitos</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, sans-serif;
    }
    html, body {
      width: 100%;
      height: 100%;
      font-size: 18px;
      line-height: 1.4;
    }
    /* Ajuste para tarjetas de forma responsiva */
    .card {
      width: 100%;
      max-width: 1200px;
      margin: 20px auto;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      background: white;
      padding: 10px;
      box-sizing: border-box;
    }
    .card-header {
      padding: 20px 20px 0;
      border-bottom: 1px solid #e5e7eb;
    }
    .card-title {
      font-size: 26px;
      font-weight: 600;
      margin-bottom: 10px;
    }
    .card-content {
      padding: 20px;
      background-color: #f9f9f9;
    }
    .grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
    }
    .column {
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 20px;
      background-color: #fcfcfc;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    }
    @media (max-width: 768px) {
      .grid {
        grid-template-columns: 1fr;
      }
    }
    .header-section {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      flex-wrap: wrap;
      gap: 10px;
      border-bottom: 1px solid #eaeaea;
      padding-bottom: 15px;
    }
    .section-title {
      font-size: 20px;
      font-weight: 600;
    }
    .reset-button {
      padding: 8px 16px;
      border: 1px solid #e5e7eb;
      border-radius: 4px;
      background: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 16px;
      touch-action: manipulation;
    }
    .reset-button:hover {
      background: #f9fafb;
    }
    .feature-item {
      margin-bottom: 24px;
    }
    .feature-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
      flex-wrap: wrap;
    }
    .feature-label {
      font-size: 16px;
      font-weight: 500;
    }
    .weight-value {
      font-size: 16px;
      color: #6b7280;
      margin-left: 8px;
    }
    .slider {
      width: 100%;
      max-width: 130px;
      appearance: none;
      background: transparent;
      --slider-thumb-color: #3b82f6;
    }
    .slider:focus {
      outline: none;
    }
    .slider::-webkit-slider-runnable-track {
      height: 4px;
      background: #d1d5db;
      border-radius: 2px;
    }
    .slider::-webkit-slider-thumb {
      appearance: none;
      width: 24px;
      height: 24px;
      background: var(--slider-thumb-color);
      border-radius: 50%;
      margin-top: -10px;
      cursor: pointer;
    }
    .slider::-moz-range-track {
      height: 4px;
      background: #d1d5db;
      border-radius: 2px;
    }
    .slider::-moz-range-thumb {
      width: 24px;
      height: 24px;
      background: var(--slider-thumb-color);
      border-radius: 50%;
      cursor: pointer;
    }
    .results {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    .result-item {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 8px 0;
      border-bottom: 1px solid #f3f4f6;
      flex-wrap: nowrap;
    }
    .result-item:last-child {
      border-bottom: none;
    }
    .rank {
      width: 32px;
      font-size: 16px;
      color: #6b7280;
    }
    .ia-name {
      flex: 1;
      font-weight: 500;
      font-size: 16px;
    }
    .score-container {
      display: flex;
      flex-direction: column;
      min-width: 120px;
    }
    .score-bar {
      height: 8px;
      background-color: #e5e7eb;
      border-radius: 4px;
      overflow: hidden;
      margin-bottom: 4px;
    }
    .score-fill {
      height: 100%;
      border-radius: 4px;
    }
    .score-value {
      font-size: 14px;
      font-weight: 600;
      text-align: right;
    }
    .score-fill-green  { background-color: #22c55e; }
    .score-fill-blue   { background-color: #3b82f6; }
    .score-fill-yellow { background-color: #eab308; }
    .score-fill-orange { background-color: #f97316; }
    .score-fill-red    { background-color: #ef4444; }
    .score-rating {
      font-size: 12px;
      text-align: right;
    }
    .rating-excellent { color: #22c55e; }
    .rating-good { color: #3b82f6; }
    .rating-average { color: #eab308; }
    .rating-fair { color: #f97316; }
    .rating-poor { color: #ef4444; }
    .footer {
      margin-top: 24px;
      text-align: center;
      font-size: 16px;
      color: #6b7280;
    }
    .footer a {
      color: inherit;
      text-decoration: underline;
    }
    .footer a:hover {
      color: #374151;
    }
    .explanation {
      margin-top: 16px;
      font-size: 15px;
      color: #555;
    }
    .language-switcher {
      display: flex;
      gap: 8px;
      justify-content: flex-end;
      margin-bottom: 15px;
    }
    .lang-btn {
      padding: 6px 12px;
      border: 1px solid #e5e7eb;
      border-radius: 20px;
      background: white;
      cursor: pointer;
      font-size: 12px;
      text-transform: uppercase;
      transition: all 0.2s;
      touch-action: manipulation;
    }
    .lang-btn:hover {
      background: #f3f4f6;
      transform: scale(1.05);
    }
    .lang-btn.active {
      background: #3b82f6;
      color: white;
      border-color: #3b82f6;
    }
    @media (max-width: 480px) {
      html, body {
        font-size: 16px;
      }
      .card {
        margin: 10px;
        padding: 5px;
      }
      .card-content {
        padding: 10px;
      }
      .card-title {
        font-size: 22px;
      }
      .section-title {
        font-size: 18px;
      }
      .reset-button {
        padding: 6px 12px;
        font-size: 14px;
      }
      .feature-label {
        font-size: 16px;
        margin-bottom: 4px;
        width: 100%;
      }
      .weight-value {
        font-size: 14px;
        width: 100%;
        text-align: right;
      }
      .slider {
        max-width: 100%;
        margin-top: 5px;
      }
      .feature-item {
        margin-bottom: 16px;
      }
      .rank,
      .ia-name {
        font-size: 16px;
      }
      .score-container {
        min-width: 110px;
      }
      .score-value {
        font-size: 14px;
      }
      .score-rating {
        font-size: 12px;
      }
      .footer {
        font-size: 14px;
      }
    }
    @media (max-width: 360px) {
      .result-item {
        flex-wrap: wrap;
      }
      .rank {
        width: 15%;
      }
      .ia-name {
        width: 80%;
      }
      .score-container {
        width: 100%;
        margin-top: 5px;
        margin-left: 15%;
      }
    }
  </style>
</head>
<body>
  <div class="card">
    <div class="language-switcher">
      <button class="lang-btn active" onclick="changeLanguage('es')">ES</button>
      <button class="lang-btn" onclick="changeLanguage('ca')">CA</button>
      <button class="lang-btn" onclick="changeLanguage('en')">EN</button>
    </div>
    <div class="card-header">
      <h1 class="card-title" data-translate="title">Selección de chatbots gratuitos</h1>
    </div>
    <div class="card-content">
      <div class="grid">
        <div class="column">
          <div class="header-section">
            <h2 class="section-title" data-translate="assign_importance">Asignar importancia</h2>
            <button class="reset-button" onclick="resetWeights()">
              <span data-translate="reset">↺ Restaurar</span>
            </button>
          </div>
          <div id="features">
            <div class="feature-item">
              <div class="feature-header">
                <label class="feature-label">Generación de imágenes</label>
                <span class="weight-value" id="weight-1">Media</span>
              </div>
              <input type="range" min="0" max="4" step="1" value="2" class="slider" id="slider-1" oninput="updateWeight(1, this.value)">
            </div>
            <div class="feature-item">
              <div class="feature-header">
                <label class="feature-label">Generación de video</label>
                <span class="weight-value" id="weight-2">Media</span>
              </div>
              <input type="range" min="0" max="4" step="1" value="2" class="slider" id="slider-2" oninput="updateWeight(2, this.value)">
            </div>
            <div class="feature-item">
              <div class="feature-header">
                <label class="feature-label">Intérprete de código</label>
                <span class="weight-value" id="weight-3">Media</span>
              </div>
              <input type="range" min="0" max="4" step="1" value="2" class="slider" id="slider-3" oninput="updateWeight(3, this.value)">
            </div>
            <div class="feature-item">
              <div class="feature-header">
                <label class="feature-label">Compartir públicamente conversaciones completas</label>
                <span class="weight-value" id="weight-4">Baja</span>
              </div>
              <input type="range" min="0" max="4" step="1" value="1" class="slider" id="slider-4" oninput="updateWeight(4, this.value)">
            </div>
            <div class="feature-item">
              <div class="feature-header">
                <label class="feature-label">Subir documentos de texto</label>
                <span class="weight-value" id="weight-5">Baja</span>
              </div>
              <input type="range" min="0" max="4" step="1" value="1" class="slider" id="slider-5" oninput="updateWeight(5, this.value)">
            </div>
            <div class="feature-item">
              <div class="feature-header">
                <label class="feature-label">Puede ver las imágenes de los PDF</label>
                <span class="weight-value" id="weight-6">Baja</span>
              </div>
              <input type="range" min="0" max="4" step="1" value="1" class="slider" id="slider-6" oninput="updateWeight(6, this.value)">
            </div>
            <div class="feature-item">
              <div class="feature-header">
                <label class="feature-label">Cálculos matemáticos exactos mediante programación</label>
                <span class="weight-value" id="weight-7">Baja</span>
              </div>
              <input type="range" min="0" max="4" step="1" value="1" class="slider" id="slider-7" oninput="updateWeight(7, this.value)">
            </div>
            <div class="feature-item">
              <div class="feature-header">
                <label class="feature-label">Con modo de razonamiento</label>
                <span class="weight-value" id="weight-8">Baja</span>
              </div>
              <input type="range" min="0" max="4" step="1" value="1" class="slider" id="slider-8" oninput="updateWeight(8, this.value)">
            </div>
            <div class="feature-item">
              <div class="feature-header">
                <label class="feature-label">Con búsqueda profunda</label>
                <span class="weight-value" id="weight-9">Baja</span>
              </div>
              <input type="range" min="0" max="4" step="1" value="1" class="slider" id="slider-9" oninput="updateWeight(9, this.value)">
            </div>
            <div class="feature-item">
              <div class="feature-header">
                <label class="feature-label">Con chat privado (incógnito)</label>
                <span class="weight-value" id="weight-10">Baja</span>
              </div>
              <input type="range" min="0" max="4" step="1" value="1" class="slider" id="slider-10" oninput="updateWeight(10, this.value)">
            </div>
            <div class="feature-item">
              <div class="feature-header">
                <label class="feature-label">Creación de agentes (espacios de trabajo)</label>
                <span class="weight-value" id="weight-11">Baja</span>
              </div>
              <input type="range" min="0" max="4" step="1" value="1" class="slider" id="slider-11" oninput="updateWeight(11, this.value)">
            </div>
            <div class="feature-item">
              <div class="feature-header">
                <label class="feature-label">Con canvas (lienzo)</label>
                <span class="weight-value" id="weight-12">Baja</span>
              </div>
              <input type="range" min="0" max="4" step="1" value="1" class="slider" id="slider-12" oninput="updateWeight(12, this.value)">
            </div>
            <div class="feature-item">
              <div class="feature-header">
                <label class="feature-label">Conexión con otros servicios (Google Drive, Dropbox, etc.)</label>
                <span class="weight-value" id="weight-13">Baja</span>
              </div>
              <input type="range" min="0" max="4" step="1" value="1" class="slider" id="slider-13" oninput="updateWeight(13, this.value)">
            </div>
            <div class="feature-item">
              <div class="feature-header">
                <label class="feature-label">Edad mínima de uso</label>
                <span class="weight-value" id="weight-14">Indiferente</span>
              </div>
              <input type="range" min="0" max="1" step="1" value="0" class="slider" id="slider-14" oninput="updateWeight(14, this.value)">
            </div>
          </div>
        </div>
        <div class="column">
          <h2 class="section-title" style="margin-bottom: 24px;" data-translate="results">Resultados</h2>
          <div id="results" class="results">
            <!-- Los resultados se generarán dinámicamente con JavaScript -->
          </div>
        </div>
      </div>
      <div class="footer">
        <div style="margin-bottom: 16px;" data-translate="note">Nota: Esta calificación es subjetiva y puede variar según las necesidades específicas de cada usuario.</div>
        <a href="https://educacion.bilateria.org/que-ia-me-conviene-comparativa-de-chatbots" target="_blank" data-translate="question">¿Qué IA me conviene? Comparativa de chatbots</a>
      </div>
    </div>
  </div>

  <script>
    // Calificaciones en diferentes idiomas
    const ratings = {
      'es': ["Básico", "Regular", "Correcto", "Bueno", "Excelente"],
      'ca': ["Bàsic", "Regular", "Correcte", "Bo", "Excel·lent"],
      'en': ["Basic", "Fair", "Good", "Very Good", "Excellent"]
    };
    
    // Traducciones
    const translations = {
      'es': {
        'title': 'Selección de chatbots gratuitos',
        'assign_importance': 'Asignar importancia',
        'reset': '↺ Restaurar',
        'results': 'Resultados',
        'note': 'Nota: Esta calificación es subjetiva y puede variar según las necesidades específicas de cada usuario.',
        'question': '¿Qué IA me conviene? Comparativa de chatbots',
        'features': [
          "Con personalización de las respuestas",
          "Generación de imágenes",
          "Generación de video",
          "Intérprete de código",
          "Compartir públicamente conversaciones completas",
          "Subir documentos de texto",
          "Puede ver las imágenes de los PDF",
          "Cálculos matemáticos exactos mediante programación",
          "Con modo de razonamiento",
          "Con búsqueda profunda",
          "Con chat privado (incógnito)",
          "Creación de agentes (espacios de trabajo)",
          "Con canvas (lienzo)",
          "Conexión con otros servicios (Google Drive, Dropbox, etc.)",
          "Edad mínima de uso"
        ]
      },
      'ca': {
        'title': 'Selecció de chatbots gratuïts',
        'assign_importance': 'Assignar importància',
        'reset': '↺ Restaurar',
        'results': 'Resultats',
        'note': 'Nota: Aquesta qualificació és subjectiva i pot variar segons les necessitats específiques de cada usuari.',
        'question': 'Quina IA em convé? Comparativa de chatbots',
        'features': [
          "Amb personalització de les respostes",
          "Generació d'imatges",
          "Generació de vídeo",
          "Intèrpret de codi",
          "Compartir públicament converses completes",
          "Pujar documents de text",
          "Pot veure les imatges dels PDF",
          "Càlculs matemàtics exactes mitjançant programació",
          "Amb mode de raonament",
          "Amb cerca profunda",
          "Amb xat privat (incògnit)",
          "Creació d'agents (espais de treball)",
          "Amb canvas (llenç)",
          "Connexió amb altres serveis (Google Drive, Dropbox, etc.)",
          "Edat mínima d'ús"
        ]
      },
      'en': {
        'title': 'Free chatbots selection',
        'assign_importance': 'Assign importance',
        'reset': '↺ Reset',
        'results': 'Results',
        'note': 'Note: This rating is subjective and may vary according to each user\'s specific needs.',
        'question': 'Which AI suits me? Chatbot comparison',
        'features': [
          "With response customization",
          "Image generation",
          "Video generation",
          "Code interpreter",
          "Publicly share complete conversations",
          "Upload text documents",
          "Can view images in PDFs",
          "Exact mathematical calculations through programming",
          "With reasoning mode",
          "With deep search",
          "With private chat (incognito)",
          "Creation of agents (workspaces)",
          "With canvas",
          "Connection with other services (Google Drive, Dropbox, etc.)",
          "Minimum age for use"
        ]
      }
    };

    // Etiquetas para los deslizadores (rango 0..4)
    const sliderLabels = {
      'es': ["Sin importancia", "Baja", "Media", "Alta", "Obligatorio"],
      'ca': ["Sense importància", "Baixa", "Mitjana", "Alta", "Obligatori"],
      'en': ["Not important", "Low", "Medium", "High", "Required"]
    };

    // Etiquetas para el deslizador de edad (rango 0..1)
    const ageSliderLabels = {
      'es': ["Indiferente", "Menores"],
      'ca': ["Indiferent", "Menors"],
      'en': ["Indifferent", "Minors"]
    };

    // IAs en el orden de la tabla actualizada según CSV 16/08/2025
    const ias = [
      "Grok",
      "ChatGPT",
      "Gemini",
      "Le Chat",
      "Perplexity",
      "Qwen",
      "Kimi",
      "Copilot",
      "Claude",
      "DeepSeek",
      "Phind"
    ];

    /*
      Índice de características actualizadas según CSV 16/08/2025:
      0: Con personalización de las respuestas (0 o 1)
      1: Generación de imágenes (0 o 1)
      2: Generación de video (0 o 1)
      3: Intérprete de código (0 o 1)
      4: Compartir públicamente conversaciones completas (0 o 1)
      5: Subir documentos de texto (0 o 1)
      6: Puede ver las imágenes de los PDF (0 o 1)
      7: Cálculos matemáticos exactos mediante programación (0 o 1)
      8: Con modo de razonamiento (0 o 1)
      9: Con búsqueda profunda (0 o 1)
      10: Con chat privado (incógnito) (0 o 1)
      11: Creación de agentes (espacios de trabajo) (0 o 1)
      12: Con canvas (lienzo) (0 o 1)
      13: Conexión con otros servicios (Google Drive, Dropbox, etc.) (0 o 1)
      14: Edad mínima de uso
    */

    const capabilities = {
      "Grok":        [1, 1, 1, 1, 1, 1, 0, 0, 1, 1, 1, 1, 1, 1, 13],
      "ChatGPT":     [1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 0, 1, 1, 14],
      "Gemini":      [1, 1, 0, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 14],
      "Le Chat":     [0, 1, 0, 1, 1, 1, 1, 1, 1, 0, 0, 1, 1, 1, 13],
      "Perplexity":  [1, 0, 0, 0, 1, 1, 0, 0, 1, 1, 1, 1, 0, 1, 13],
      "Qwen":        [0, 1, 1, 1, 1, 1, 0, 0, 1, 1, 1, 0, 0, 0, 18],
      "Kimi":        [0, 0, 0, 1, 1, 1, 0, 0, 1, 1, 0, 0, 0, 0, 14],
      "Copilot":     [0, 1, 0, 0, 1, 1, 0, 0, 1, 0, 0, 0, 1, 0, 14],
      "Claude":      [1, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 18],
      "DeepSeek":    [0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 14],
      "Phind":       [1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 14]
    };

    // Detecta el idioma inicial del navegador
    let currentLang = navigator.language.substring(0,2);
    if (!['es', 'ca', 'en'].includes(currentLang)) currentLang = 'es';

    // Inicialmente, los 14 primeros deslizadores a 2 (Media) y el de edad a 0 (Indiferente)
    let weights = Array(translations[currentLang].features.length).fill(2);
    weights[translations[currentLang].features.length - 1] = 0;

    // Devuelve true si alguna característica obligatoria falla
    function failsMandatoryRequirement(iaCapabilities) {
      for (let i = 0; i < weights.length - 1; i++) {
        if (weights[i] === 4 && iaCapabilities[i] === 0) {
          return true;
        }
      }
      return false;
    }

    // Crea los sliders de cada característica
    function createFeatureSliders() {
      const container = document.getElementById('features');
      if (!container) return;

      const featuresArr = translations[currentLang].features;
      container.innerHTML = featuresArr.map((feature, index) => {
        if (index < featuresArr.length - 1) {
          const label = sliderLabels[currentLang][2];
          return `
            <div class="feature-item">
              <div class="feature-header">
                <label class="feature-label">${feature}</label>
                <span class="weight-value" id="weight-${index}">${label}</span>
              </div>
              <input
                type="range"
                min="0"
                max="4"
                step="1"
                value="2"
                class="slider"
                id="slider-${index}"
                onInput="updateWeight(${index}, this.value)"
              >
            </div>
          `;
        } else {
          const label = ageSliderLabels[currentLang][0];
          return `
            <div class="feature-item">
              <div class="feature-header">
                <label class="feature-label">${feature}</label>
                <span class="weight-value" id="weight-${index}">${label}</span>
              </div>
              <input
                type="range"
                min="0"
                max="1"
                step="1"
                value="0"
                class="slider"
                id="slider-${index}"
                onInput="updateWeight(${index}, this.value)"
              >
            </div>
          `;
        }
      }).join('');
    }

    // Actualiza las traducciones de elementos
    function updateTranslations() {
      document.querySelectorAll('[data-translate]').forEach(el => {
        const key = el.dataset.translate;
        if (translations[currentLang][key]) {
          el.textContent = translations[currentLang][key];
        }
      });
      document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.textContent === currentLang.toUpperCase()) {
          btn.classList.add('active');
        }
      });
      const featureLabels = document.querySelectorAll('.feature-label');
      if (featureLabels.length > 0) {
        translations[currentLang].features.forEach((text, index) => {
          if (featureLabels[index]) featureLabels[index].textContent = text;
        });
      }
      const footerNote = document.querySelector('.footer div');
      const footerLink = document.querySelector('.footer a');
      if (footerNote) footerNote.textContent = translations[currentLang].note;
      if (footerLink) {
        footerLink.textContent = translations[currentLang].question;
        footerLink.href = "https://educacion.bilateria.org/que-ia-me-conviene-comparativa-de-chatbots";
      }
    }

    // Cambio de idioma
    function changeLanguage(lang) {
      currentLang = lang;
      weights = Array(translations[currentLang].features.length).fill(2);
      weights[translations[currentLang].features.length - 1] = 0;
      updateTranslations();
      createFeatureSliders();
      updateScores();
    }

    // Función para obtener el color del slider basado en el valor
    function getSliderColor(value) {
      const colors = {
        0: "#9ca3af", // Gris - Sin importancia
        1: "#10b981", // Verde - Baja
        2: "#3b82f6", // Azul - Media
        3: "#f59e0b", // Naranja - Alta
        4: "#ef4444"  // Rojo - Obligatorio
      };
      return colors[value];
    }

    // Actualiza el valor de un deslizador
    function updateWeight(index, value) {
      let label;
      if (index < translations[currentLang].features.length - 1) {
        label = sliderLabels[currentLang][value];
      } else {
        label = ageSliderLabels[currentLang][value];
      }
      weights[index] = parseInt(value);
      document.getElementById(`weight-${index}`).textContent = label;

      const sliderEl = document.getElementById(`slider-${index}`);
      if (index < translations[currentLang].features.length - 1) {
        sliderEl.style.setProperty("--slider-thumb-color", getSliderColor(value));
      } else {
        sliderEl.style.setProperty("--slider-thumb-color", "#3b82f6");
      }
      updateScores();
    }

    // Restablece todos los deslizadores a sus valores por defecto
    function resetWeights() {
      weights = Array(translations[currentLang].features.length).fill(2);
      weights[translations[currentLang].features.length - 1] = 0;
      const labelsForCurrentLang = sliderLabels[currentLang];
      const featuresArr = translations[currentLang].features;
      document.querySelectorAll('.slider').forEach((slider, index) => {
        if (index < featuresArr.length - 1) {
          slider.value = 2;
          document.getElementById(`weight-${index}`).textContent = labelsForCurrentLang[2];
          slider.style.setProperty("--slider-thumb-color", getSliderColor(2));
        } else {
          slider.value = 0;
          document.getElementById(`weight-${index}`).textContent = ageSliderLabels[currentLang][0];
          slider.style.setProperty("--slider-thumb-color", "#3b82f6");
        }
      });
      updateScores();
    }

    // Calcula el color de la puntuación en función del porcentaje
    function getScoreColor(percentage) {
      if (percentage >= 80) return 'score-green';
      if (percentage >= 60) return 'score-blue';
      if (percentage >= 40) return 'score-yellow';
      if (percentage >= 20) return 'score-orange';
      return 'score-red';
    }

    // Calcula la puntuación total para cada IA
    function updateScores() {
      const scores = ias.map(ia => {
        let baseScore = 0;
        for (let i = 0; i < weights.length - 1; i++) {
          baseScore += capabilities[ia][i] * weights[i];
        }
        if (failsMandatoryRequirement(capabilities[ia])) {
          return { ia, score: 0 };
        }
        let bonus;
        if (weights[weights.length - 1] === 0) {
          bonus = (capabilities[ia][14] < 18 ? 1 : 0);
        } else if (weights[weights.length - 1] === 1) {
          bonus = (capabilities[ia][14] < 18 ? 1 : null);
        }
        if (bonus === null) {
          baseScore = 0;
        } else {
          baseScore += bonus;
        }
        return { ia, score: Math.round(baseScore) };
      }).sort((a, b) => b.score - a.score);

      const container = document.getElementById('results');
      if (!container) return;

      container.innerHTML = scores.map(({ ia, score }, index) => {
        const maxPossibleScore = weights.reduce((sum, weight, i) => sum + (i < weights.length - 1 ? weight * 1 : 0), 0) + 1;
        const percentage = maxPossibleScore > 0 ? Math.round((score / maxPossibleScore) * 100) : 0;
        const colorClass = getScoreColor(percentage);
        
        // Determinar la calificación textual
        let ratingIndex, ratingClass;
        if (percentage >= 80) {
          ratingIndex = 4; // Excelente
          ratingClass = "rating-excellent";
        } else if (percentage >= 60) {
          ratingIndex = 3; // Bueno
          ratingClass = "rating-good";
        } else if (percentage >= 40) {
          ratingIndex = 2; // Correcto
          ratingClass = "rating-average";
        } else if (percentage >= 20) {
          ratingIndex = 1; // Regular
          ratingClass = "rating-fair";
        } else {
          ratingIndex = 0; // Básico
          ratingClass = "rating-poor";
        }
        const ratingText = ratings[currentLang][ratingIndex];
        
        return `
          <div class="result-item">
            <span class="rank">#${index + 1}</span>
            <span class="ia-name">${ia}</span>
            <div class="score-container">
              <div class="score-bar">
                <div class="score-fill score-fill-${colorClass.replace('score-', '')}" style="width: ${percentage}%"></div>
              </div>
              <div class="score-value">${percentage}%</div>
              <div class="score-rating ${ratingClass}">${ratingText}</div>
            </div>
          </div>
        `;
      }).join('');
    }

    document.addEventListener('DOMContentLoaded', () => {
      updateTranslations();
      createFeatureSliders();
      updateScores();
    });

    // Hacer accesibles las funciones globalmente
    window.resetWeights = resetWeights;
    window.changeLanguage = changeLanguage;
    window.updateWeight = updateWeight;
  </script>
  
  <div style="margin-top: 20px; padding: 10px; text-align: center; font-size: 14px; border-top: 1px solid #e5e7eb;">
    Laboratorio de aplicaciones educativas <a href="https://labia.tiddlyhost.com">labia.tiddlyhost.com</a><br>
    Aplicación hecha por <a href="https://bilateria.org">Juan José de Haro</a><br>
    Esta obra está bajo una licencia <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.es">Creative Commons BY-SA</a>
  </div>
</body>
</html>
